import{b as N,c as k}from "../chunk-VPETNEZ6.js";import{a as G}from "../chunk-YCWZY6JB.js";import{i as n,r as J}from "../chunk-7MEJP3IB.js";import"../chunk-FW4363Y4.js";function M(){var t;return typeof MediaRecorder=="function"&&typeof((t=MediaRecorder.prototype)==null?void 0:t.start)=="function"}function j(t){let{recording:r,onStartRecording:s,onStopRecording:i,i18n:o}=t;return r?n("button",{className:"uppy-u-reset uppy-c-btn uppy-Audio-button",type:"button",title:o("stopAudioRecording"),"aria-label":o("stopAudioRecording"),onClick:i,"data-uppy-super-focusable":!0},n("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"100",height:"100",viewBox:"0 0 100 100"},n("rect",{x:"15",y:"15",width:"70",height:"70"}))):n("button",{className:"uppy-u-reset uppy-c-btn uppy-Audio-button",type:"button",title:o("startAudioRecording"),"aria-label":o("startAudioRecording"),onClick:s,"data-uppy-super-focusable":!0},n("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"14px",height:"20px",viewBox:"0 0 14 20"},n("path",{d:"M7 14c2.21 0 4-1.71 4-3.818V3.818C11 1.71 9.21 0 7 0S3 1.71 3 3.818v6.364C3 12.29 4.79 14 7 14zm6.364-7h-.637a.643.643 0 0 0-.636.65V9.6c0 3.039-2.565 5.477-5.6 5.175-2.645-.264-4.582-2.692-4.582-5.407V7.65c0-.36-.285-.65-.636-.65H.636A.643.643 0 0 0 0 7.65v1.631c0 3.642 2.544 6.888 6.045 7.382v1.387H3.818a.643.643 0 0 0-.636.65v.65c0 .36.285.65.636.65h6.364c.351 0 .636-.29.636-.65v-.65c0-.36-.285-.65-.636-.65H7.955v-1.372C11.363 16.2 14 13.212 14 9.6V7.65c0-.36-.285-.65-.636-.65z",fill:"#FFF","fill-rule":"nonzero"})))}function z(t){return`${Math.floor(t/60)}:${String(t%60).padStart(2,"0")}`}function B(t){let{recordingLengthSeconds:r,i18n:s}=t,i=z(r);return n("span",{"aria-label":s("recordingLength",{recording_length:i})},i)}var Q= t=>{let{currentDeviceId:r,audioSources:s,onChangeSource:i}=t;return n("div",{className:"uppy-Audio-videoSource"},n("select",{className:"uppy-u-reset uppy-Audio-audioSource-select",onChange: o=>{i(o.target.value)}},s.map(o=>n("option",{key:o.deviceId,value:o.deviceId,selected:o.deviceId===r},o.label))))};function ae(t, r){if(!{}.hasOwnProperty.call(t,r))throw new TypeError("attempted to use private field on non-instance");return t}var ue=0;function ce(t){return"__private_"+ue+++"_"+t}function X(t){return typeof t=="function"}function P(t){return X(t)?t():t}var I=ce("draw"),C=class{constructor(r, s){s===void 0&&(s={}),Object.defineProperty(this,I,{writable:!0,value:()=>this.draw()});let i=s.canvas||{},o=s.canvasContext||{};this.analyser=null,this.bufferLength=0,this.canvas=r,this.width=P(i.width)||this.canvas.width,this.height=P(i.height)||this.canvas.height,this.canvas.width=this.width,this.canvas.height=this.height,this.canvasContext=this.canvas.getContext("2d"),this.canvasContext.fillStyle=P(o.fillStyle)||"rgb(255, 255, 255)",this.canvasContext.strokeStyle=P(o.strokeStyle)||"rgb(0, 0, 0)",this.canvasContext.lineWidth=P(o.lineWidth)||1,this.onDrawFrame=X(s.onDrawFrame)?s.onDrawFrame:()=>{}}addSource(r){this.streamSource=r,this.audioContext=this.streamSource.context,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.bufferLength=this.analyser.frequencyBinCount,this.source=this.audioContext.createBufferSource(),this.dataArray=new Uint8Array(this.bufferLength),this.analyser.getByteTimeDomainData(this.dataArray),this.streamSource.connect(this.analyser)}draw(){let{analyser:r,dataArray:s,bufferLength:i}=this,o=this.canvasContext,c=this.width,p=this.height;r&&r.getByteTimeDomainData(s),o.fillRect(0,0,c,p),o.beginPath();let y=c*1/i,g=0;i||o.moveTo(0,this.height/2);for(let f=0; f<i; f++){let R=s[f]/128*(p/2);f===0?o.moveTo(g,R):o.lineTo(g,R),g+=y}o.lineTo(c,p/2),o.stroke(),this.onDrawFrame(this),requestAnimationFrame(ae(this,I)[I])}};function de(t){let{onSubmit:r,i18n:s}=t;return n("button",{className:"uppy-u-reset uppy-c-btn uppy-Audio-button uppy-Audio-button--submit",type:"button",title:s("submitRecordedFile"),"aria-label":s("submitRecordedFile"),onClick:r,"data-uppy-super-focusable":!0},n("svg",{width:"12",height:"9",viewBox:"0 0 12 9",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:"uppy-c-icon"},n("path",{fill:"#fff",fillRule:"nonzero",d:"M10.66 0L12 1.31 4.136 9 0 4.956l1.34-1.31L4.136 6.38z"})))}var Y=de;function le(t){let{onDiscard:r,i18n:s}=t;return n("button",{className:"uppy-u-reset uppy-c-btn uppy-Audio-button",type:"button",title:s("discardRecordedFile"),"aria-label":s("discardRecordedFile"),onClick:r,"data-uppy-super-focusable":!0},n("svg",{width:"13",height:"13",viewBox:"0 0 13 13",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",className:"uppy-c-icon"},n("g",{fill:"#FFF",fillRule:"evenodd"},n("path",{d:"M.496 11.367L11.103.76l1.414 1.414L1.911 12.781z"}),n("path",{d:"M11.104 12.782L.497 2.175 1.911.76l10.607 10.606z"}))))}var Z=le;function T(t){let{stream:r,recordedAudio:s,onStop:i,recording:o,supportsRecording:c,audioSources:p,showAudioSourceDropdown:y,onSubmit:g,i18n:f,onStartRecording:O,onStopRecording:R,onDiscardRecordedAudio:ie,recordingLengthSeconds:re}=t,K=k(null),F=k();N(()=>()=>{F.current=null,i()},[i]),N(()=>{if(!s&&(F.current=new C(K.current,{canvas:{width:600,height:600},canvasContext:{lineWidth:2,fillStyle:"rgb(0,0,0)",strokeStyle:"green"}}),F.current.draw(),r)){let se=new AudioContext().createMediaStreamSource(r);F.current.addSource(se)}},[s,r]);let x=s!=null,oe=!x&&c,ne=y&&!x&&p&&p.length>1;return n("div",{className:"uppy-Audio-container"},n("div",{className:"uppy-Audio-audioContainer"},x?n("audio",{className:"uppy-Audio-player",controls:!0,src:s}):n("canvas",{ref:K,className:"uppy-Audio-canvas"})),n("div",{className:"uppy-Audio-footer"},n("div",{className:"uppy-Audio-audioSourceContainer"},ne?Q(t):null),n("div",{className:"uppy-Audio-buttonContainer"},oe&&n(j,{recording:o,onStartRecording:O,onStopRecording:R,i18n:f}),x&&n(Y,{onSubmit:g,i18n:f}),x&&n(Z,{onDiscard:ie,i18n:f})),n("div",{className:"uppy-Audio-recordingLength"},!x&&n(B,{recordingLengthSeconds:re,i18n:f}))))}var ee= t=>{let{icon:r,hasAudio:s,i18n:i}=t;return n("div",{className:"uppy-Audio-permissons"},n("div",{className:"uppy-Audio-permissonsIcon"},r()),n("div",{className:"uppy-Audio-title"},i(s?"allowAudioAccessTitle":"noAudioTitle")),n("p",null,i(s?"allowAudioAccessDescription":"noAudioDescription")))};var te={strings:{pluginNameAudio:"Audio",startAudioRecording:"Begin audio recording",stopAudioRecording:"Stop audio recording",allowAudioAccessTitle:"Please allow access to your microphone",allowAudioAccessDescription:"In order to record audio, please allow microphone access for this site.",noAudioTitle:"Microphone Not Available",noAudioDescription:"In order to record audio, please connect a microphone or another audio input device",recordingStoppedMaxSize:"Recording stopped because the file size is about to exceed the limit",recordingLength:"Recording length %{recording_length}",submitRecordedFile:"Submit recorded file",discardRecordedFile:"Discard recorded file"}};function q(){return q=Object.assign?Object.assign.bind():function(t){for(var r=1; r<arguments.length; r++){var s=arguments[r];for(var i in s)({}).hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t},q.apply(null,arguments)}function e(t, r){if(!{}.hasOwnProperty.call(t,r))throw new TypeError("attempted to use private field on non-instance");return t}var he=0;function d(t){return"__private_"+he+++"_"+t}var pe={version:"2.1.2"},b=d("recordingLengthTimer"),l=d("stream"),S=d("audioActive"),u=d("recordingChunks"),a=d("recorder"),v=d("capturedMediaFile"),h=d("mediaDevices"),L=d("supportsUserMedia"),E=d("hasAudioCheck"),w=d("start"),U=d("startRecording"),_=d("stopRecording"),$=d("discardRecordedAudio"),V=d("submit"),m=d("stop"),H=d("getAudio"),W=d("changeSource"),A=d("updateSources"),D=class extends J{constructor(r, s){super(r,s),Object.defineProperty(this,H,{value:ge}),Object.defineProperty(this,E,{value:fe}),Object.defineProperty(this,b,{writable:!0,value:void 0}),Object.defineProperty(this,l,{writable:!0,value:null}),Object.defineProperty(this,S,{writable:!0,value:!1}),Object.defineProperty(this,u,{writable:!0,value:null}),Object.defineProperty(this,a,{writable:!0,value:null}),Object.defineProperty(this,v,{writable:!0,value:null}),Object.defineProperty(this,h,{writable:!0,value:void 0}),Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,w,{writable:!0,value: i=>{if(!e(this,L)[L])return Promise.reject(new Error("Microphone access not supported"));e(this,S)[S]=!0,e(this,E)[E]().then(o=>(this.setPluginState({hasAudio:o}),e(this,h)[h].getUserMedia({audio:!0}).then(c=>{e(this,l)[l]=c;let p=null,y=c.getAudioTracks();i!=null&&i.deviceId?p=y.findLast(g=>g.getSettings().deviceId===i.deviceId):p=y[0].getSettings().deviceId,e(this,A)[A](),this.setPluginState({currentDeviceId:p,audioReady:!0})}).catch(c=>{this.setPluginState({audioReady:!1,cameraError:c}),this.uppy.info(c.message,"error")})))}}),Object.defineProperty(this,U,{writable:!0,value:()=>{e(this,a)[a]=new MediaRecorder(e(this,l)[l]),e(this,u)[u]=[];let i=!1;e(this,a)[a].addEventListener("dataavailable", o=>{e(this,u)[u].push(o.data);let{restrictions:c}=this.uppy.opts;if(e(this,u)[u].length>1&&c.maxFileSize!=null&&!i){let p=e(this,u)[u].reduce((O, R)=>O+R.size,0),g=(p-e(this,u)[u][0].size)/(e(this,u)[u].length-1)*3,f=Math.max(0,c.maxFileSize-g);p>f&&(i=!0,this.uppy.info(this.i18n("recordingStoppedMaxSize"),"warning",4e3),e(this,_)[_]())}}),e(this,a)[a].start(500),e(this,b)[b]=setInterval(()=>{let o=this.getPluginState().recordingLengthSeconds;this.setPluginState({recordingLengthSeconds:o+1})},1e3),this.setPluginState({isRecording:!0})}}),Object.defineProperty(this,_,{writable:!0,value:()=>new Promise(o=>{e(this,a)[a].addEventListener("stop",()=>{o()}),e(this,a)[a].stop(),clearInterval(e(this,b)[b]),this.setPluginState({recordingLengthSeconds:0})}).then(()=>(this.setPluginState({isRecording:!1}),e(this,H)[H]())).then(o=>{try{e(this,v)[v]=o,this.setPluginState({recordedAudio:URL.createObjectURL(o.data)})}catch(c){c.isRestriction||this.uppy.log(c)}}).then(()=>{e(this,u)[u]=null,e(this,a)[a]=null}, o=>{throw e(this,u)[u]=null,e(this,a)[a]=null,o})}),Object.defineProperty(this,$,{writable:!0,value:()=>{this.setPluginState({recordedAudio:null}),e(this,v)[v]=null}}),Object.defineProperty(this,V,{writable:!0,value:()=>{try{e(this,v)[v]&&this.uppy.addFile(e(this,v)[v])}catch(i){i.isRestriction||this.uppy.log(i,"warning")}}}),Object.defineProperty(this,m,{writable:!0,value:async()=>{e(this,l)[l]&&e(this,l)[l].getAudioTracks().forEach(o=>o.stop()),e(this,a)[a]&&await new Promise(i=>{e(this,a)[a].addEventListener("stop",i,{once:!0}),e(this,a)[a].stop(),clearInterval(e(this,b)[b])}),e(this,u)[u]=null,e(this,a)[a]=null,e(this,S)[S]=!1,e(this,l)[l]=null,this.setPluginState({recordedAudio:null,isRecording:!1,recordingLengthSeconds:0})}}),Object.defineProperty(this,W,{writable:!0,value: i=>{e(this,m)[m](),e(this,w)[w]({deviceId:i})}}),Object.defineProperty(this,A,{writable:!0,value:()=>{e(this,h)[h].enumerateDevices().then(i=>{this.setPluginState({audioSources:i.filter(o=>o.kind==="audioinput")})})}}),e(this,h)[h]=navigator.mediaDevices,e(this,L)[L]=e(this,h)[h]!=null,this.id=this.opts.id||"Audio",this.type="acquirer",this.icon=()=>n("svg",{className:"uppy-DashboardTab-iconAudio","aria-hidden":"true",focusable:"false",width:"32px",height:"32px",viewBox:"0 0 32 32"},n("path",{d:"M21.143 12.297c.473 0 .857.383.857.857v2.572c0 3.016-2.24 5.513-5.143 5.931v2.64h2.572a.857.857 0 110 1.714H12.57a.857.857 0 110-1.714h2.572v-2.64C12.24 21.24 10 18.742 10 15.726v-2.572a.857.857 0 111.714 0v2.572A4.29 4.29 0 0016 20.01a4.29 4.29 0 004.286-4.285v-2.572c0-.474.384-.857.857-.857zM16 6.5a3 3 0 013 3v6a3 3 0 01-6 0v-6a3 3 0 013-3z",fill:"currentcolor","fill-rule":"nonzero"})),this.defaultLocale=te,this.opts={...s},this.i18nInit(),this.title=this.i18n("pluginNameAudio"),this.setPluginState({hasAudio:!1,audioReady:!1,cameraError:null,recordingLengthSeconds:0,audioSources:[],currentDeviceId:null})}render(){e(this,S)[S]||e(this,w)[w]();let r=this.getPluginState();return!r.audioReady||!r.hasAudio?n(ee,{icon:this.icon,i18n:this.i18n,hasAudio:r.hasAudio}):n(T,q({},r,{onChangeSource:e(this,W)[W],onStartRecording:e(this,U)[U],onStopRecording:e(this,_)[_],onDiscardRecordedAudio:e(this,$)[$],onSubmit:e(this,V)[V],onStop:e(this,m)[m],i18n:this.i18n,showAudioSourceDropdown:this.opts.showAudioSourceDropdown,supportsRecording:M(),recording:r.isRecording,stream:e(this,l)[l]}))}install(){this.setPluginState({audioReady:!1,recordingLengthSeconds:0});let{target:r}=this.opts;r&&this.mount(r,this),e(this,h)[h]&&(e(this,A)[A](),e(this,h)[h].ondevicechange=()=>{if(e(this,A)[A](),e(this,l)[l]){let s=!0,{audioSources:i,currentDeviceId:o}=this.getPluginState();i.forEach(c=>{o===c.deviceId&&(s=!1)}),s&&(e(this,m)[m](),e(this,w)[w]())}})}uninstall(){e(this,l)[l]&&e(this,m)[m](),this.unmount()}};function fe(){return e(this,h)[h]?e(this,h)[h].enumerateDevices().then(t=>t.some(r=>r.kind==="audioinput")):Promise.resolve(!1)}function ge(){let t=e(this,u)[u].find(c=>{var p;return((p=c.type)==null?void 0:p.length)>0}).type,r=G(t);if(!r)return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type "${t}"`));let s=`audio-${Date.now()}.${r}`,i=new Blob(e(this,u)[u],{type:t}),o={source:this.id,name:s,data:new Blob([i],{type:t}),type:t};return Promise.resolve(o)}D.VERSION=pe.version;export{D as default};
//# sourceMappingURL=audio.js.map
