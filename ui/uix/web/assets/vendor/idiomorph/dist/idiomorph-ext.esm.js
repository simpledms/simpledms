import{a as E}from"../../chunk-UFGKKXHW.js";import"../../chunk-FW4363Y4.js";var V=(function(){"use strict";let v=()=>{},g={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:v,afterNodeAdded:v,beforeNodeMorphed:v,afterNodeMorphed:v,beforeNodeRemoved:v,afterNodeRemoved:v,beforeAttributeUpdated:v},head:{style:"merge",shouldPreserve:f=>f.getAttribute("im-preserve")==="true",shouldReAppend:f=>f.getAttribute("im-re-append")==="true",shouldRemove:v,afterHeadMorphed:v},restoreFocus:!0};function M(f,m,c={}){f=R(f);let h=k(m),d=N(f,h,c),u=S(d,()=>B(d,f,h,r=>r.morphStyle==="innerHTML"?(T(r,f,h),Array.from(f.childNodes)):y(r,f,h)));return d.pantry.remove(),u}function y(f,m,c){let h=k(m);return T(f,h,c,m,m.nextSibling),Array.from(h.childNodes)}function S(f,m){if(!f.config.restoreFocus)return m();let c=document.activeElement;if(!(c instanceof HTMLInputElement||c instanceof HTMLTextAreaElement))return m();let{id:h,selectionStart:d,selectionEnd:u}=c,r=m();return h&&h!==document.activeElement?.getAttribute("id")&&(c=f.target.querySelector(`[id="${h}"]`),c?.focus()),c&&!c.selectionEnd&&u&&c.setSelectionRange(d,u),r}let T=(function(){function f(e,t,i,n=null,s=null){t instanceof HTMLTemplateElement&&i instanceof HTMLTemplateElement&&(t=t.content,i=i.content),n||=t.firstChild;for(let a of i.childNodes){if(n&&n!=s){let p=c(e,a,n,s);if(p){p!==n&&d(e,n,p),H(p,a,e),n=p.nextSibling;continue}}if(a instanceof Element){let p=a.getAttribute("id");if(e.persistentIds.has(p)){let A=u(t,p,n,e);H(A,a,e),n=A.nextSibling;continue}}let l=m(t,a,n,e);l&&(n=l.nextSibling)}for(;n&&n!=s;){let a=n;n=n.nextSibling,h(e,a)}}function m(e,t,i,n){if(n.callbacks.beforeNodeAdded(t)===!1)return null;if(n.idMap.has(t)){let s=document.createElement(t.tagName);return e.insertBefore(s,i),H(s,t,n),n.callbacks.afterNodeAdded(s),s}else{let s=document.importNode(t,!0);return e.insertBefore(s,i),n.callbacks.afterNodeAdded(s),s}}let c=(function(){function e(n,s,a,l){let p=null,A=s.nextSibling,I=0,b=a;for(;b&&b!=l;){if(i(b,s)){if(t(n,b,s))return b;p===null&&(n.idMap.has(b)||(p=b))}if(p===null&&A&&i(b,A)&&(I++,A=A.nextSibling,I>=2&&(p=void 0)),n.activeElementAndParents.includes(b))break;b=b.nextSibling}return p||null}function t(n,s,a){let l=n.idMap.get(s),p=n.idMap.get(a);if(!p||!l)return!1;for(let A of l)if(p.has(A))return!0;return!1}function i(n,s){let a=n,l=s;return a.nodeType===l.nodeType&&a.tagName===l.tagName&&(!a.getAttribute?.("id")||a.getAttribute?.("id")===l.getAttribute?.("id"))}return e})();function h(e,t){if(e.idMap.has(t))o(e.pantry,t,null);else{if(e.callbacks.beforeNodeRemoved(t)===!1)return;t.parentNode?.removeChild(t),e.callbacks.afterNodeRemoved(t)}}function d(e,t,i){let n=t;for(;n&&n!==i;){let s=n;n=n.nextSibling,h(e,s)}return n}function u(e,t,i,n){let s=n.target.getAttribute?.("id")===t&&n.target||n.target.querySelector(`[id="${t}"]`)||n.pantry.querySelector(`[id="${t}"]`);return r(s,n),o(e,s,i),s}function r(e,t){let i=e.getAttribute("id");for(;e=e.parentNode;){let n=t.idMap.get(e);n&&(n.delete(i),n.size||t.idMap.delete(e))}}function o(e,t,i){if(e.moveBefore)try{e.moveBefore(t,i)}catch{e.insertBefore(t,i)}else e.insertBefore(t,i)}return f})(),H=(function(){function f(r,o,e){return e.ignoreActive&&r===document.activeElement?null:(e.callbacks.beforeNodeMorphed(r,o)===!1||(r instanceof HTMLHeadElement&&e.head.ignore||(r instanceof HTMLHeadElement&&e.head.style!=="morph"?L(r,o,e):(m(r,o,e),u(r,e)||T(e,r,o))),e.callbacks.afterNodeMorphed(r,o)),r)}function m(r,o,e){let t=o.nodeType;if(t===1){let i=r,n=o,s=i.attributes,a=n.attributes;for(let l of a)d(l.name,i,"update",e)||i.getAttribute(l.name)!==l.value&&i.setAttribute(l.name,l.value);for(let l=s.length-1;0<=l;l--){let p=s[l];if(p&&!n.hasAttribute(p.name)){if(d(p.name,i,"remove",e))continue;i.removeAttribute(p.name)}}u(i,e)||c(i,n,e)}(t===8||t===3)&&r.nodeValue!==o.nodeValue&&(r.nodeValue=o.nodeValue)}function c(r,o,e){if(r instanceof HTMLInputElement&&o instanceof HTMLInputElement&&o.type!=="file"){let t=o.value,i=r.value;h(r,o,"checked",e),h(r,o,"disabled",e),o.hasAttribute("value")?i!==t&&(d("value",r,"update",e)||(r.setAttribute("value",t),r.value=t)):d("value",r,"remove",e)||(r.value="",r.removeAttribute("value"))}else if(r instanceof HTMLOptionElement&&o instanceof HTMLOptionElement)h(r,o,"selected",e);else if(r instanceof HTMLTextAreaElement&&o instanceof HTMLTextAreaElement){let t=o.value,i=r.value;if(d("value",r,"update",e))return;t!==i&&(r.value=t),r.firstChild&&r.firstChild.nodeValue!==t&&(r.firstChild.nodeValue=t)}}function h(r,o,e,t){let i=o[e],n=r[e];if(i!==n){let s=d(e,r,"update",t);s||(r[e]=o[e]),i?s||r.setAttribute(e,""):d(e,r,"remove",t)||r.removeAttribute(e)}}function d(r,o,e,t){return r==="value"&&t.ignoreActiveValue&&o===document.activeElement?!0:t.callbacks.beforeAttributeUpdated(r,o,e)===!1}function u(r,o){return!!o.ignoreActiveValue&&r===document.activeElement&&r!==document.body}return f})();function B(f,m,c,h){if(f.head.block){let d=m.querySelector("head"),u=c.querySelector("head");if(d&&u){let r=L(d,u,f);return Promise.all(r).then(()=>{let o=Object.assign(f,{head:{block:!1,ignore:!0}});return h(o)})}}return h(f)}function L(f,m,c){let h=[],d=[],u=[],r=[],o=new Map;for(let t of m.children)o.set(t.outerHTML,t);for(let t of f.children){let i=o.has(t.outerHTML),n=c.head.shouldReAppend(t),s=c.head.shouldPreserve(t);i||s?n?d.push(t):(o.delete(t.outerHTML),u.push(t)):c.head.style==="append"?n&&(d.push(t),r.push(t)):c.head.shouldRemove(t)!==!1&&d.push(t)}r.push(...o.values());let e=[];for(let t of r){let i=document.createRange().createContextualFragment(t.outerHTML).firstChild;if(c.callbacks.beforeNodeAdded(i)!==!1){if("href"in i&&i.href||"src"in i&&i.src){let n,s=new Promise(function(a){n=a});i.addEventListener("load",function(){n()}),e.push(s)}f.appendChild(i),c.callbacks.afterNodeAdded(i),h.push(i)}}for(let t of d)c.callbacks.beforeNodeRemoved(t)!==!1&&(f.removeChild(t),c.callbacks.afterNodeRemoved(t));return c.head.afterHeadMorphed(f,{added:h,kept:u,removed:d}),e}let N=(function(){function f(e,t,i){let{persistentIds:n,idMap:s}=r(e,t),a=m(i),l=a.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(l))throw`Do not understand how to morph style ${l}`;return{target:e,newContent:t,config:a,morphStyle:l,ignoreActive:a.ignoreActive,ignoreActiveValue:a.ignoreActiveValue,restoreFocus:a.restoreFocus,idMap:s,persistentIds:n,pantry:c(),activeElementAndParents:h(e),callbacks:a.callbacks,head:a.head}}function m(e){let t=Object.assign({},g);return Object.assign(t,e),t.callbacks=Object.assign({},g.callbacks,e.callbacks),t.head=Object.assign({},g.head,e.head),t}function c(){let e=document.createElement("div");return e.hidden=!0,document.body.insertAdjacentElement("afterend",e),e}function h(e){let t=[],i=document.activeElement;if(i?.tagName!=="BODY"&&e.contains(i))for(;i&&(t.push(i),i!==e);)i=i.parentElement;return t}function d(e){let t=Array.from(e.querySelectorAll("[id]"));return e.getAttribute?.("id")&&t.push(e),t}function u(e,t,i,n){for(let s of n){let a=s.getAttribute("id");if(t.has(a)){let l=s;for(;l;){let p=e.get(l);if(p==null&&(p=new Set,e.set(l,p)),p.add(a),l===i)break;l=l.parentElement}}}}function r(e,t){let i=d(e),n=d(t),s=o(i,n),a=new Map;u(a,s,e,i);let l=t.__idiomorphRoot||t;return u(a,s,l,n),{persistentIds:s,idMap:a}}function o(e,t){let i=new Set,n=new Map;for(let{id:a,tagName:l}of e)n.has(a)?i.add(a):n.set(a,l);let s=new Set;for(let{id:a,tagName:l}of t)s.has(a)?i.add(a):n.get(a)===l&&s.add(a);for(let a of i)s.delete(a);return s}return f})(),{normalizeElement:R,normalizeParent:k}=(function(){let f=new WeakSet;function m(u){return u instanceof Document?u.documentElement:u}function c(u){if(u==null)return document.createElement("div");if(typeof u=="string")return c(d(u));if(f.has(u))return u;if(u instanceof Node){if(u.parentNode)return new h(u);{let r=document.createElement("div");return r.append(u),r}}else{let r=document.createElement("div");for(let o of[...u])r.append(o);return r}}class h{constructor(r){this.originalNode=r,this.realParentNode=r.parentNode,this.previousSibling=r.previousSibling,this.nextSibling=r.nextSibling}get childNodes(){let r=[],o=this.previousSibling?this.previousSibling.nextSibling:this.realParentNode.firstChild;for(;o&&o!=this.nextSibling;)r.push(o),o=o.nextSibling;return r}querySelectorAll(r){return this.childNodes.reduce((o,e)=>{if(e instanceof Element){e.matches(r)&&o.push(e);let t=e.querySelectorAll(r);for(let i=0;i<t.length;i++)o.push(t[i])}return o},[])}insertBefore(r,o){return this.realParentNode.insertBefore(r,o)}moveBefore(r,o){return this.realParentNode.moveBefore(r,o)}get __idiomorphRoot(){return this.originalNode}}function d(u){let r=new DOMParser,o=u.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(o.match(/<\/html>/)||o.match(/<\/head>/)||o.match(/<\/body>/)){let e=r.parseFromString(u,"text/html");if(o.match(/<\/html>/))return f.add(e),e;{let t=e.firstChild;return t&&f.add(t),t}}else{let t=r.parseFromString("<body><template>"+u+"</template></body>","text/html").body.querySelector("template").content;return f.add(t),t}}return{normalizeElement:m,normalizeParent:c}})();return{morph:M,defaults:g}})();(function(){function v(g){if(g==="morph"||g==="morph:outerHTML")return{morphStyle:"outerHTML"};if(g==="morph:innerHTML")return{morphStyle:"innerHTML"};if(g.startsWith("morph:"))return Function("return ("+g.slice(6)+")")()}E.defineExtension("morph",{isInlineSwap:function(g){let M=v(g);return M?.morphStyle==="outerHTML"||M?.morphStyle==null},handleSwap:function(g,M,y){let S=v(g);if(S)return V.morph(M,y.children,S)}})})();export{V as Idiomorph};
//# sourceMappingURL=idiomorph-ext.esm.js.map
