import{a as b}from"../chunk-YCWZY6JB.js";import{c as F,i,l as O,r as E}from"../chunk-7MEJP3IB.js";import{a as te,b as ie}from"../chunk-FW4363Y4.js";var W=te((ge,y)=>{"use strict";y.exports=R;y.exports.isMobile=R;y.exports.default=R;var oe=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser.*mobile|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,re=/CrOS/,se=/android|ipad|playbook|silk/i;function R(o){o||(o={});let e=o.ua;if(!e&&typeof navigator<"u"&&(e=navigator.userAgent),e&&e.headers&&typeof e.headers["user-agent"]=="string"&&(e=e.headers["user-agent"]),typeof e!="string")return!1;let t=oe.test(e)&&!re.test(e)||!!o.tablet&&se.test(e);return!t&&o.tablet&&o.featureDetect&&navigator&&navigator.maxTouchPoints>1&&e.indexOf("Macintosh")!==-1&&e.indexOf("Safari")!==-1&&(t=!0),t}});var U=ie(W(),1);function C(o,e,t){return new Promise(r=>{o.toBlob(r,e,t)})}function x(){return typeof MediaRecorder=="function"&&!!MediaRecorder.prototype&&typeof MediaRecorder.prototype.start=="function"}function g(){return i("svg",{"aria-hidden":"true",focusable:"false",fill:"#0097DC",width:"66",height:"55",viewBox:"0 0 66 55"},i("path",{d:"M57.3 8.433c4.59 0 8.1 3.51 8.1 8.1v29.7c0 4.59-3.51 8.1-8.1 8.1H8.7c-4.59 0-8.1-3.51-8.1-8.1v-29.7c0-4.59 3.51-8.1 8.1-8.1h9.45l4.59-7.02c.54-.54 1.35-1.08 2.16-1.08h16.2c.81 0 1.62.54 2.16 1.08l4.59 7.02h9.45zM33 14.64c-8.62 0-15.393 6.773-15.393 15.393 0 8.62 6.773 15.393 15.393 15.393 8.62 0 15.393-6.773 15.393-15.393 0-8.62-6.773-15.393-15.393-15.393zM33 40c-5.648 0-9.966-4.319-9.966-9.967 0-5.647 4.318-9.966 9.966-9.966s9.966 4.319 9.966 9.966C42.966 35.681 38.648 40 33 40z",fillRule:"evenodd"}))}function M(o){let{onSnapshot:e,i18n:t}=o;return i("button",{className:"uppy-u-reset uppy-c-btn uppy-Webcam-button uppy-Webcam-button--picture",type:"button",title:t("takePicture"),"aria-label":t("takePicture"),onClick:e,"data-uppy-super-focusable":!0},g())}function P(o){let{recording:e,onStartRecording:t,onStopRecording:r,i18n:s}=o;return e?i("button",{className:"uppy-u-reset uppy-c-btn uppy-Webcam-button",type:"button",title:s("stopRecording"),"aria-label":s("stopRecording"),onClick:r,"data-uppy-super-focusable":!0},i("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"100",height:"100",viewBox:"0 0 100 100"},i("rect",{x:"15",y:"15",width:"70",height:"70"}))):i("button",{className:"uppy-u-reset uppy-c-btn uppy-Webcam-button",type:"button",title:s("startRecording"),"aria-label":s("startRecording"),onClick:t,"data-uppy-super-focusable":!0},i("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"100",height:"100",viewBox:"0 0 100 100"},i("circle",{cx:"50",cy:"50",r:"40"})))}function k(o){return`${Math.floor(o/60)}:${String(o%60).padStart(2,"0")}`}function T(o){let{recordingLengthSeconds:e,i18n:t}=o,r=k(e);return i("span",{"aria-label":t("recordingLength",{recording_length:r})},r)}function V(o){let{currentDeviceId:e,videoSources:t,onChangeVideoSource:r}=o;return i("div",{className:"uppy-Webcam-videoSource"},i("select",{className:"uppy-u-reset uppy-Webcam-videoSource-select",onChange:s=>{r(s.target.value)}},t.map(s=>i("option",{key:s.deviceId,value:s.deviceId,selected:s.deviceId===e},s.label))))}function ne(o){let{onSubmit:e,i18n:t}=o;return i("button",{className:"uppy-u-reset uppy-c-btn uppy-Webcam-button uppy-Webcam-button--submit",type:"button",title:t("submitRecordedFile"),"aria-label":t("submitRecordedFile"),onClick:e,"data-uppy-super-focusable":!0},i("svg",{width:"12",height:"9",viewBox:"0 0 12 9",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:"uppy-c-icon"},i("path",{fill:"#fff",fillRule:"nonzero",d:"M10.66 0L12 1.31 4.136 9 0 4.956l1.34-1.31L4.136 6.38z"})))}var z=ne;function ae(o){let{onDiscard:e,i18n:t}=o;return i("button",{className:"uppy-u-reset uppy-c-btn uppy-Webcam-button uppy-Webcam-button--discard",type:"button",title:t("discardRecordedFile"),"aria-label":t("discardRecordedFile"),onClick:e,"data-uppy-super-focusable":!0},i("svg",{width:"13",height:"13",viewBox:"0 0 13 13",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:"uppy-c-icon"},i("g",{fill:"#FFF",fillRule:"evenodd"},i("path",{d:"M.496 11.367L11.103.76l1.414 1.414L1.911 12.781z"}),i("path",{d:"M11.104 12.782L.497 2.175 1.911.76l10.607 10.606z"}))))}var A=ae;function I(){return I=Object.assign?Object.assign.bind():function(o){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(o[r]=t[r])}return o},I.apply(null,arguments)}function S(o,e){return o.includes(e)}var L=class extends O{componentDidMount(){let{onFocus:e}=this.props;e()}componentWillUnmount(){let{onStop:e}=this.props;e()}render(){let{src:e,recordedVideo:t,recording:r,modes:s,supportsRecording:n,videoSources:a,showVideoSourceDropdown:c,showRecordingLength:d,onSubmit:l,i18n:p,mirror:w,onSnapshot:H,onStartRecording:q,onStopRecording:J,onDiscardRecordedVideo:K,recordingLengthSeconds:G}=this.props,m=!!t,Q=!m&&n&&(S(s,"video-only")||S(s,"audio-only")||S(s,"video-audio")),X=!m&&S(s,"picture"),Y=n&&d&&!m,Z=c&&a&&a.length>1,h={playsInline:!0};return t?(h.muted=!1,h.controls=!0,h.src=t,this.videoElement&&(this.videoElement.srcObject=null)):(h.muted=!0,h.autoPlay=!0,h.srcObject=e),i("div",{className:"uppy uppy-Webcam-container"},i("div",{className:"uppy-Webcam-videoContainer"},i("video",I({ref:ee=>this.videoElement=ee,className:`uppy-Webcam-video  ${w?"uppy-Webcam-video--mirrored":""}`},h))),i("div",{className:"uppy-Webcam-footer"},i("div",{className:"uppy-Webcam-videoSourceContainer"},Z?V(this.props):null),i("div",{className:"uppy-Webcam-buttonContainer"},X&&i(M,{onSnapshot:H,i18n:p}),Q&&i(P,{recording:r,onStartRecording:q,onStopRecording:J,i18n:p}),m&&i(z,{onSubmit:l,i18n:p}),m&&i(A,{onDiscard:K,i18n:p})),i("div",{className:"uppy-Webcam-recordingLength"},Y&&i(T,{recordingLengthSeconds:G,i18n:p}))))}},j=L;function D(o){let{icon:e,i18n:t,hasCamera:r}=o;return i("div",{className:"uppy-Webcam-permissons"},i("div",{className:"uppy-Webcam-permissonsIcon"},e()),i("div",{className:"uppy-Webcam-title"},t(r?"allowAccessTitle":"noCameraTitle")),i("p",null,t(r?"allowAccessDescription":"noCameraDescription")))}var _={strings:{pluginNameCamera:"Camera",noCameraTitle:"Camera Not Available",noCameraDescription:"In order to take pictures or record video, please connect a camera device",recordingStoppedMaxSize:"Recording stopped because the file size is about to exceed the limit",submitRecordedFile:"Submit recorded file",discardRecordedFile:"Discard recorded file",smile:"Smile!",takePicture:"Take a picture",startRecording:"Begin video recording",stopRecording:"Stop video recording",recordingLength:"Recording length %{recording_length}",allowAccessTitle:"Please allow access to your camera",allowAccessDescription:"In order to take pictures or record video with your camera, please allow camera access for this site."}};function N(){return N=Object.assign?Object.assign.bind():function(o){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)({}).hasOwnProperty.call(t,r)&&(o[r]=t[r])}return o},N.apply(null,arguments)}function f(o,e){if(!{}.hasOwnProperty.call(o,e))throw new TypeError("attempted to use private field on non-instance");return o}var ce=0;function de(o){return"__private_"+ce+++"_"+o}var ue={version:"4.1.2"};function $(o){return o[0]==="."?F[o.slice(1)]:o}function le(o){return/^video\/[^*]+$/.test(o)}function pe(o){return/^image\/[^*]+$/.test(o)}function he(){return navigator.mediaDevices}function B(o,e){return o.includes(e)}var me={onBeforeSnapshot:()=>Promise.resolve(),countdown:!1,modes:["video-audio","video-only","audio-only","picture"],mirror:!0,showVideoSourceDropdown:!1,preferredImageMimeType:null,preferredVideoMimeType:null,showRecordingLength:!1,mobileNativeCamera:(0,U.default)({tablet:!0})},u=de("enableMirror"),v=class extends E{constructor(e,t){super(e,{...me,...t}),Object.defineProperty(this,u,{writable:!0,value:void 0}),this.stream=null,this.recorder=null,this.recordingChunks=null,this.captureInProgress=!1,this.mediaDevices=he(),this.supportsUserMedia=!!this.mediaDevices,this.protocol=location.protocol.match(/https/i)?"https":"http",this.id=this.opts.id||"Webcam",this.type="acquirer",this.capturedMediaFile=null,this.icon=()=>i("svg",{"aria-hidden":"true",focusable:"false",width:"32",height:"32",viewBox:"0 0 32 32"},i("path",{d:"M23.5 9.5c1.417 0 2.5 1.083 2.5 2.5v9.167c0 1.416-1.083 2.5-2.5 2.5h-15c-1.417 0-2.5-1.084-2.5-2.5V12c0-1.417 1.083-2.5 2.5-2.5h2.917l1.416-2.167C13 7.167 13.25 7 13.5 7h5c.25 0 .5.167.667.333L20.583 9.5H23.5zM16 11.417a4.706 4.706 0 00-4.75 4.75 4.704 4.704 0 004.75 4.75 4.703 4.703 0 004.75-4.75c0-2.663-2.09-4.75-4.75-4.75zm0 7.825c-1.744 0-3.076-1.332-3.076-3.074 0-1.745 1.333-3.077 3.076-3.077 1.744 0 3.074 1.333 3.074 3.076s-1.33 3.075-3.074 3.075z",fill:"#02B383",fillRule:"nonzero"})),this.defaultLocale=_,this.i18nInit(),this.title=this.i18n("pluginNameCamera"),f(this,u)[u]=this.opts.mirror,this.install=this.install.bind(this),this.setPluginState=this.setPluginState.bind(this),this.render=this.render.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.takeSnapshot=this.takeSnapshot.bind(this),this.startRecording=this.startRecording.bind(this),this.stopRecording=this.stopRecording.bind(this),this.discardRecordedVideo=this.discardRecordedVideo.bind(this),this.submit=this.submit.bind(this),this.oneTwoThreeSmile=this.oneTwoThreeSmile.bind(this),this.focus=this.focus.bind(this),this.changeVideoSource=this.changeVideoSource.bind(this),this.webcamActive=!1,this.opts.countdown&&(this.opts.onBeforeSnapshot=this.oneTwoThreeSmile),this.setPluginState({hasCamera:!1,cameraReady:!1,cameraError:null,recordingLengthSeconds:0,videoSources:[],currentDeviceId:null})}setOptions(e){super.setOptions({...e,videoConstraints:{...this.opts.videoConstraints,...e?.videoConstraints}})}hasCameraCheck(){return this.mediaDevices?this.mediaDevices.enumerateDevices().then(e=>e.some(t=>t.kind==="videoinput")):Promise.resolve(!1)}isAudioOnly(){return this.opts.modes.length===1&&this.opts.modes[0]==="audio-only"}getConstraints(e){e===void 0&&(e=null);let t=this.opts.modes.indexOf("video-audio")!==-1||this.opts.modes.indexOf("audio-only")!==-1,r=!this.isAudioOnly()&&(this.opts.modes.indexOf("video-audio")!==-1||this.opts.modes.indexOf("video-only")!==-1||this.opts.modes.indexOf("picture")!==-1),s={...this.opts.videoConstraints||{},...e!=null&&{deviceId:e}};return{audio:t,video:r?s:!1}}start(e){var t;if(e===void 0&&(e=null),!this.supportsUserMedia)return Promise.reject(new Error("Webcam access not supported"));this.webcamActive=!0,this.opts.mirror&&(f(this,u)[u]=!0);let r=this.getConstraints((t=e)==null?void 0:t.deviceId);this.hasCameraCheck().then(s=>(this.setPluginState({hasCamera:s}),this.mediaDevices.getUserMedia(r).then(n=>{this.stream=n;let a=null,c=this.isAudioOnly()?n.getAudioTracks():n.getVideoTracks();!e||!e.deviceId?a=c[0].getSettings().deviceId:c.forEach(d=>{d.getSettings().deviceId===e.deviceId&&(a=d.getSettings().deviceId)}),this.updateVideoSources(),this.setPluginState({currentDeviceId:a,cameraReady:!0})}).catch(n=>{this.setPluginState({cameraReady:!1,cameraError:n}),this.uppy.info(n.message,"error")})))}getMediaRecorderOptions(){let e={};if(MediaRecorder.isTypeSupported){let{restrictions:t}=this.uppy.opts,r=[];this.opts.preferredVideoMimeType?r=[this.opts.preferredVideoMimeType]:t.allowedFileTypes&&(r=t.allowedFileTypes.map($).filter(le));let s=a=>MediaRecorder.isTypeSupported(a)&&b(a),n=r.filter(s);n.length>0&&(e.mimeType=n[0])}return e}startRecording(){this.recorder=new MediaRecorder(this.stream,this.getMediaRecorderOptions()),this.recordingChunks=[];let e=!1;this.recorder.addEventListener("dataavailable",t=>{this.recordingChunks.push(t.data);let{restrictions:r}=this.uppy.opts;if(this.recordingChunks.length>1&&r.maxFileSize!=null&&!e){let s=this.recordingChunks.reduce((d,l)=>d+l.size,0),a=(s-this.recordingChunks[0].size)/(this.recordingChunks.length-1)*3,c=Math.max(0,r.maxFileSize-a);s>c&&(e=!0,this.uppy.info(this.i18n("recordingStoppedMaxSize"),"warning",4e3),this.stopRecording())}}),this.recorder.start(500),this.opts.showRecordingLength&&(this.recordingLengthTimer=setInterval(()=>{let t=this.getPluginState().recordingLengthSeconds;this.setPluginState({recordingLengthSeconds:t+1})},1e3)),this.setPluginState({isRecording:!0})}stopRecording(){return new Promise(t=>{this.recorder.addEventListener("stop",()=>{t()}),this.recorder.stop(),this.opts.showRecordingLength&&(clearInterval(this.recordingLengthTimer),this.setPluginState({recordingLengthSeconds:0}))}).then(()=>(this.setPluginState({isRecording:!1}),this.getVideo())).then(t=>{try{this.capturedMediaFile=t,this.setPluginState({recordedVideo:URL.createObjectURL(t.data)}),f(this,u)[u]=!1}catch(r){r.isRestriction||this.uppy.log(r)}}).then(()=>{this.recordingChunks=null,this.recorder=null},t=>{throw this.recordingChunks=null,this.recorder=null,t})}discardRecordedVideo(){this.setPluginState({recordedVideo:null}),this.opts.mirror&&(f(this,u)[u]=!0),this.capturedMediaFile=null}submit(){try{this.capturedMediaFile&&this.uppy.addFile(this.capturedMediaFile)}catch(e){e.isRestriction||this.uppy.log(e,"error")}}async stop(){if(this.stream){let e=this.stream.getAudioTracks(),t=this.stream.getVideoTracks();e.concat(t).forEach(r=>r.stop())}this.recorder&&await new Promise(e=>{this.recorder.addEventListener("stop",e,{once:!0}),this.recorder.stop(),this.opts.showRecordingLength&&clearInterval(this.recordingLengthTimer)}),this.recordingChunks=null,this.recorder=null,this.webcamActive=!1,this.stream=null,this.setPluginState({recordedVideo:null,isRecording:!1,recordingLengthSeconds:0})}getVideoElement(){return this.el.querySelector(".uppy-Webcam-video")}oneTwoThreeSmile(){return new Promise((e,t)=>{let r=this.opts.countdown,s=setInterval(()=>{if(!this.webcamActive)return clearInterval(s),this.captureInProgress=!1,t(new Error("Webcam is not active"));r?(this.uppy.info(`${r}...`,"warning",800),r--):(clearInterval(s),this.uppy.info(this.i18n("smile"),"success",1500),setTimeout(()=>e(),1500))},1e3)})}takeSnapshot(){this.captureInProgress||(this.captureInProgress=!0,this.opts.onBeforeSnapshot().catch(e=>{let t=typeof e=="object"?e.message:e;return this.uppy.info(t,"error",5e3),Promise.reject(new Error(`onBeforeSnapshot: ${t}`))}).then(()=>this.getImage()).then(e=>{this.captureInProgress=!1;try{this.uppy.addFile(e)}catch(t){t.isRestriction||this.uppy.log(t)}},e=>{throw this.captureInProgress=!1,e}))}getImage(){let e=this.getVideoElement();if(!e)return Promise.reject(new Error("No video element found, likely due to the Webcam tab being closed."));let t=e.videoWidth,r=e.videoHeight,s=document.createElement("canvas");s.width=t,s.height=r,s.getContext("2d").drawImage(e,0,0);let{restrictions:a}=this.uppy.opts,c=[];this.opts.preferredImageMimeType?c=[this.opts.preferredImageMimeType]:a.allowedFileTypes&&(c=a.allowedFileTypes.map($).filter(pe));let d=c[0]||"image/jpeg",l=b(d)||"jpg",p=`cam-${Date.now()}.${l}`;return C(s,d).then(w=>({source:this.id,name:p,data:new Blob([w],{type:d}),type:d}))}getVideo(){let e=this.recordingChunks.find(a=>{var c;return((c=a.type)==null?void 0:c.length)>0}).type,t=b(e);if(!t)return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type "${e}"`));let r=`webcam-${Date.now()}.${t}`,s=new Blob(this.recordingChunks,{type:e}),n={source:this.id,name:r,data:new Blob([s],{type:e}),type:e};return Promise.resolve(n)}focus(){this.opts.countdown&&setTimeout(()=>{this.uppy.info(this.i18n("smile"),"success",1500)},1e3)}changeVideoSource(e){this.stop(),this.start({deviceId:e})}updateVideoSources(){this.mediaDevices.enumerateDevices().then(e=>{this.setPluginState({videoSources:e.filter(t=>t.kind==="videoinput")})})}render(){this.webcamActive||this.start();let e=this.getPluginState();return!e.cameraReady||!e.hasCamera?i(D,{icon:g,i18n:this.i18n,hasCamera:e.hasCamera}):i(j,N({},e,{onChangeVideoSource:this.changeVideoSource,onSnapshot:this.takeSnapshot,onStartRecording:this.startRecording,onStopRecording:this.stopRecording,onDiscardRecordedVideo:this.discardRecordedVideo,onSubmit:this.submit,onFocus:this.focus,onStop:this.stop,i18n:this.i18n,modes:this.opts.modes,showRecordingLength:this.opts.showRecordingLength,showVideoSourceDropdown:this.opts.showVideoSourceDropdown,supportsRecording:x(),recording:e.isRecording,mirror:f(this,u)[u],src:this.stream}))}install(){let{mobileNativeCamera:e,modes:t,videoConstraints:r}=this.opts,{target:s}=this.opts;if(e&&s){var n;(n=this.getTargetPlugin(s))==null||n.setOptions({showNativeVideoCameraButton:B(t,"video-only")||B(t,"video-audio"),showNativePhotoCameraButton:B(t,"picture"),nativeCameraFacingMode:r?.facingMode});return}this.setPluginState({cameraReady:!1,recordingLengthSeconds:0}),s&&this.mount(s,this),this.mediaDevices&&(this.updateVideoSources(),this.mediaDevices.ondevicechange=()=>{if(this.updateVideoSources(),this.stream){let a=!0,{videoSources:c,currentDeviceId:d}=this.getPluginState();c.forEach(l=>{d===l.deviceId&&(a=!1)}),a&&(this.stop(),this.start())}})}uninstall(){this.stop(),this.unmount()}onUnmount(){this.stop()}};v.VERSION=ue.version;export{v as default};
//# sourceMappingURL=webcam.js.map
