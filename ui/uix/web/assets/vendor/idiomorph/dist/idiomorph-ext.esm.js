import{a as N}from "../../chunk-IWJSAC3R.js";import"../../chunk-FW4363Y4.js";var E=function(){"use strict";let g=()=>{},v={morphStyle:"outerHTML",callbacks:{beforeNodeAdded:g,afterNodeAdded:g,beforeNodeMorphed:g,afterNodeMorphed:g,beforeNodeRemoved:g,afterNodeRemoved:g,beforeAttributeUpdated:g},head:{style:"merge",shouldPreserve: a=>a.getAttribute("im-preserve")==="true",shouldReAppend: a=>a.getAttribute("im-re-append")==="true",shouldRemove:g,afterHeadMorphed:g},restoreFocus:!0};function M(a, p, f={}){a=V(a);let c=k(p),d=R(a,c,f),u=A(d,()=>B(d,a,c, r=>r.morphStyle==="innerHTML"?(T(r,a,c),Array.from(a.childNodes)):y(r,a,c)));return d.pantry.remove(),u}function y(a, p, f){let c=k(p);return T(a,c,f,p,p.nextSibling),Array.from(c.childNodes)}function A(a, p){if(!a.config.restoreFocus)return p();let f=document.activeElement;if(!(f instanceof HTMLInputElement||f instanceof HTMLTextAreaElement))return p();let{id:c,selectionStart:d,selectionEnd:u}=f,r=p();return c&&c!==document.activeElement?.id&&(f=a.target.querySelector(`[id="${c}"]`),f?.focus()),f&&!f.selectionEnd&&u&&f.setSelectionRange(d,u),r}let T=function(){function a(e, t, s, i=null, o=null){t instanceof HTMLTemplateElement&&s instanceof HTMLTemplateElement&&(t=t.content,s=s.content),i||=t.firstChild;for(let l of s.childNodes){if(i&&i!=o){let h=f(e,l,i,o);if(h){h!==i&&d(e,i,h),H(h,l,e),i=h.nextSibling;continue}}if(l instanceof Element&&e.persistentIds.has(l.id)){let h=u(t,l.id,i,e);H(h,l,e),i=h.nextSibling;continue}let m=p(t,l,i,e);m&&(i=m.nextSibling)}for(; i&&i!=o;){let l=i;i=i.nextSibling,c(e,l)}}function p(e, t, s, i){if(i.callbacks.beforeNodeAdded(t)===!1)return null;if(i.idMap.has(t)){let o=document.createElement(t.tagName);return e.insertBefore(o,s),H(o,t,i),i.callbacks.afterNodeAdded(o),o}else{let o=document.importNode(t,!0);return e.insertBefore(o,s),i.callbacks.afterNodeAdded(o),o}}let f=function(){function e(i, o, l, m){let h=null,S=o.nextSibling,I=0,b=l;for(; b&&b!=m;){if(s(b,o)){if(t(i,b,o))return b;h===null&&(i.idMap.has(b)||(h=b))}if(h===null&&S&&s(b,S)&&(I++,S=S.nextSibling,I>=2&&(h=void 0)),b.contains(document.activeElement))break;b=b.nextSibling}return h||null}function t(i, o, l){let m=i.idMap.get(o),h=i.idMap.get(l);if(!h||!m)return!1;for(let S of m)if(h.has(S))return!0;return!1}function s(i, o){let l=i,m=o;return l.nodeType===m.nodeType&&l.tagName===m.tagName&&(!l.id||l.id===m.id)}return e}();function c(e, t){if(e.idMap.has(t))n(e.pantry,t,null);else{if(e.callbacks.beforeNodeRemoved(t)===!1)return;t.parentNode?.removeChild(t),e.callbacks.afterNodeRemoved(t)}}function d(e, t, s){let i=t;for(; i&&i!==s;){let o=i;i=i.nextSibling,c(e,o)}return i}function u(e, t, s, i){let o=i.target.id===t&&i.target||i.target.querySelector(`[id="${t}"]`)||i.pantry.querySelector(`[id="${t}"]`);return r(o,i),n(e,o,s),o}function r(e, t){let s=e.id;for(; e=e.parentNode;){let i=t.idMap.get(e);i&&(i.delete(s),i.size||t.idMap.delete(e))}}function n(e, t, s){if(e.moveBefore)try{e.moveBefore(t,s)}catch{e.insertBefore(t,s)}else e.insertBefore(t,s)}return a}(),H=function(){function a(r, n, e){return e.ignoreActive&&r===document.activeElement?null:(e.callbacks.beforeNodeMorphed(r,n)===!1||(r instanceof HTMLHeadElement&&e.head.ignore||(r instanceof HTMLHeadElement&&e.head.style!=="morph"?L(r,n,e):(p(r,n,e),u(r,e)||T(e,r,n))),e.callbacks.afterNodeMorphed(r,n)),r)}function p(r, n, e){let t=n.nodeType;if(t===1){let s=r,i=n,o=s.attributes,l=i.attributes;for(let m of l)d(m.name,s,"update",e)||s.getAttribute(m.name)!==m.value&&s.setAttribute(m.name,m.value);for(let m=o.length-1; 0<=m; m--){let h=o[m];if(h&&!i.hasAttribute(h.name)){if(d(h.name,s,"remove",e))continue;s.removeAttribute(h.name)}}u(s,e)||f(s,i,e)}(t===8||t===3)&&r.nodeValue!==n.nodeValue&&(r.nodeValue=n.nodeValue)}function f(r, n, e){if(r instanceof HTMLInputElement&&n instanceof HTMLInputElement&&n.type!=="file"){let t=n.value,s=r.value;c(r,n,"checked",e),c(r,n,"disabled",e),n.hasAttribute("value")?s!==t&&(d("value",r,"update",e)||(r.setAttribute("value",t),r.value=t)):d("value",r,"remove",e)||(r.value="",r.removeAttribute("value"))}else if(r instanceof HTMLOptionElement&&n instanceof HTMLOptionElement)c(r,n,"selected",e);else if(r instanceof HTMLTextAreaElement&&n instanceof HTMLTextAreaElement){let t=n.value,s=r.value;if(d("value",r,"update",e))return;t!==s&&(r.value=t),r.firstChild&&r.firstChild.nodeValue!==t&&(r.firstChild.nodeValue=t)}}function c(r, n, e, t){let s=n[e],i=r[e];if(s!==i){let o=d(e,r,"update",t);o||(r[e]=n[e]),s?o||r.setAttribute(e,""):d(e,r,"remove",t)||r.removeAttribute(e)}}function d(r, n, e, t){return r==="value"&&t.ignoreActiveValue&&n===document.activeElement?!0:t.callbacks.beforeAttributeUpdated(r,n,e)===!1}function u(r, n){return!!n.ignoreActiveValue&&r===document.activeElement&&r!==document.body}return a}();function B(a, p, f, c){if(a.head.block){let d=p.querySelector("head"),u=f.querySelector("head");if(d&&u){let r=L(d,u,a);return Promise.all(r).then(()=>{let n=Object.assign(a,{head:{block:!1,ignore:!0}});return c(n)})}}return c(a)}function L(a, p, f){let c=[],d=[],u=[],r=[],n=new Map;for(let t of p.children)n.set(t.outerHTML,t);for(let t of a.children){let s=n.has(t.outerHTML),i=f.head.shouldReAppend(t),o=f.head.shouldPreserve(t);s||o?i?d.push(t):(n.delete(t.outerHTML),u.push(t)):f.head.style==="append"?i&&(d.push(t),r.push(t)):f.head.shouldRemove(t)!==!1&&d.push(t)}r.push(...n.values());let e=[];for(let t of r){let s=document.createRange().createContextualFragment(t.outerHTML).firstChild;if(f.callbacks.beforeNodeAdded(s)!==!1){if("href"in s&&s.href||"src"in s&&s.src){let i,o=new Promise(function(l){i=l});s.addEventListener("load",function(){i()}),e.push(o)}a.appendChild(s),f.callbacks.afterNodeAdded(s),c.push(s)}}for(let t of d)f.callbacks.beforeNodeRemoved(t)!==!1&&(a.removeChild(t),f.callbacks.afterNodeRemoved(t));return f.head.afterHeadMorphed(a,{added:c,kept:u,removed:d}),e}let R=function(){function a(n, e, t){let{persistentIds:s,idMap:i}=u(n,e),o=p(t),l=o.morphStyle||"outerHTML";if(!["innerHTML","outerHTML"].includes(l))throw`Do not understand how to morph style ${l}`;return{target:n,newContent:e,config:o,morphStyle:l,ignoreActive:o.ignoreActive,ignoreActiveValue:o.ignoreActiveValue,restoreFocus:o.restoreFocus,idMap:i,persistentIds:s,pantry:f(),callbacks:o.callbacks,head:o.head}}function p(n){let e=Object.assign({},v);return Object.assign(e,n),e.callbacks=Object.assign({},v.callbacks,n.callbacks),e.head=Object.assign({},v.head,n.head),e}function f(){let n=document.createElement("div");return n.hidden=!0,document.body.insertAdjacentElement("afterend",n),n}function c(n){let e=Array.from(n.querySelectorAll("[id]"));return n.id&&e.push(n),e}function d(n, e, t, s){for(let i of s)if(e.has(i.id)){let o=i;for(; o;){let l=n.get(o);if(l==null&&(l=new Set,n.set(o,l)),l.add(i.id),o===t)break;o=o.parentElement}}}function u(n, e){let t=c(n),s=c(e),i=r(t,s),o=new Map;d(o,i,n,t);let l=e.__idiomorphRoot||e;return d(o,i,l,s),{persistentIds:i,idMap:o}}function r(n, e){let t=new Set,s=new Map;for(let{id:o,tagName:l}of n)s.has(o)?t.add(o):s.set(o,l);let i=new Set;for(let{id:o,tagName:l}of e)i.has(o)?t.add(o):s.get(o)===l&&i.add(o);for(let o of t)i.delete(o);return i}return a}(),{normalizeElement:V,normalizeParent:k}=function(){let a=new WeakSet;function p(u){return u instanceof Document?u.documentElement:u}function f(u){if(u==null)return document.createElement("div");if(typeof u=="string")return f(d(u));if(a.has(u))return u;if(u instanceof Node){if(u.parentNode)return new c(u);{let r=document.createElement("div");return r.append(u),r}}else{let r=document.createElement("div");for(let n of[...u])r.append(n);return r}}class c{constructor(r){this.originalNode=r,this.realParentNode=r.parentNode,this.previousSibling=r.previousSibling,this.nextSibling=r.nextSibling}get childNodes(){let r=[],n=this.previousSibling?this.previousSibling.nextSibling:this.realParentNode.firstChild;for(; n&&n!=this.nextSibling;)r.push(n),n=n.nextSibling;return r}querySelectorAll(r){return this.childNodes.reduce((n, e)=>{if(e instanceof Element){e.matches(r)&&n.push(e);let t=e.querySelectorAll(r);for(let s=0; s<t.length; s++)n.push(t[s])}return n},[])}insertBefore(r, n){return this.realParentNode.insertBefore(r,n)}moveBefore(r, n){return this.realParentNode.moveBefore(r,n)}get __idiomorphRoot(){return this.originalNode}}function d(u){let r=new DOMParser,n=u.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(n.match(/<\/html>/)||n.match(/<\/head>/)||n.match(/<\/body>/)){let e=r.parseFromString(u,"text/html");if(n.match(/<\/html>/))return a.add(e),e;{let t=e.firstChild;return t&&a.add(t),t}}else{let t=r.parseFromString("<body><template>"+u+"</template></body>","text/html").body.querySelector("template").content;return a.add(t),t}}return{normalizeElement:p,normalizeParent:f}}();return{morph:M,defaults:v}}();(function(){function g(v){if(v==="morph"||v==="morph:outerHTML")return{morphStyle:"outerHTML"};if(v==="morph:innerHTML")return{morphStyle:"innerHTML"};if(v.startsWith("morph:"))return Function("return ("+v.slice(6)+")")()}N.defineExtension("morph",{isInlineSwap:function(v){let M=g(v);return M?.morphStyle==="outerHTML"||M?.morphStyle==null},handleSwap:function(v, M, y){let A=g(v);if(A)return E.morph(M,y.children,A)}})})();export{E as Idiomorph};
//# sourceMappingURL=idiomorph-ext.esm.js.map
