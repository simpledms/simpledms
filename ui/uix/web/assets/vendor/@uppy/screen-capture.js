import{a as c}from "../chunk-YCWZY6JB.js";import{i as e,l as u,r as S}from "../chunk-7MEJP3IB.js";import"../chunk-FW4363Y4.js";function d(){return e("svg",{className:"uppy-DashboardTab-iconScreenRec","aria-hidden":"true",focusable:"false",width:"32",height:"32",viewBox:"0 0 32 32"},e("g",{fill:"currentcolor",fillRule:"evenodd"},e("path",{d:"M24.182 9H7.818C6.81 9 6 9.742 6 10.667v10c0 .916.81 1.666 1.818 1.666h4.546V24h7.272v-1.667h4.546c1 0 1.809-.75 1.809-1.666l.009-10C26 9.742 25.182 9 24.182 9zM24 21H8V11h16v10z"}),e("circle",{cx:"16",cy:"16",r:"2"})))}function h(s){let{recording:t,onStartRecording:i,onStopRecording:r,i18n:a}=s;return t?e("button",{className:"uppy-u-reset uppy-c-btn uppy-ScreenCapture-button uppy-ScreenCapture-button--video uppy-ScreenCapture-button--stop-rec",type:"button",title:a("stopCapturing"),"aria-label":a("stopCapturing"),onClick:r,"data-uppy-super-focusable":!0},e("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"100",height:"100",viewBox:"0 0 100 100"},e("rect",{x:"15",y:"15",width:"70",height:"70"}))):e("button",{className:"uppy-u-reset uppy-c-btn uppy-ScreenCapture-button uppy-ScreenCapture-button--video",type:"button",title:a("startCapturing"),"aria-label":a("startCapturing"),onClick:i,"data-uppy-super-focusable":!0},e("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"100",height:"100",viewBox:"0 0 100 100"},e("circle",{cx:"50",cy:"50",r:"40"})))}function l(s){let{recording:t,recordedVideo:i,onSubmit:r,i18n:a}=s;return i&&!t?e("button",{className:"uppy-u-reset uppy-c-btn uppy-ScreenCapture-button uppy-ScreenCapture-button--submit",type:"button",title:a("submitRecordedFile"),"aria-label":a("submitRecordedFile"),onClick:r,"data-uppy-super-focusable":!0},e("svg",{width:"12",height:"9",viewBox:"0 0 12 9",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:"uppy-c-icon"},e("path",{fill:"#fff",fillRule:"nonzero",d:"M10.66 0L12 1.31 4.136 9 0 4.956l1.34-1.31L4.136 6.38z"}))):null}function C(s){return(s-(s%=60))/60+(s>9?":":":0")+s}var p=class extends u{constructor(t){super(t),this.wrapperStyle={width:"100%",height:"100%",display:"flex"},this.overlayStyle={position:"absolute",width:"100%",height:"100%",background:"black",opacity:.7},this.infoContainerStyle={marginLeft:"auto",marginRight:"auto",marginTop:"auto",marginBottom:"auto",zIndex:1,color:"white"},this.infotextStyle={marginLeft:"auto",marginRight:"auto",marginBottom:"1rem",fontSize:"1.5rem"},this.timeStyle={display:"block",fontWeight:"bold",marginLeft:"auto",marginRight:"auto",fontSize:"3rem",fontFamily:"Courier New"},this.timerRunning=!1,this.state={elapsedTime:0}}startTimer(){this.timerTick(),this.timerRunning=!0}resetTimer(){clearTimeout(this.timer),this.setState({elapsedTime:0}),this.timerRunning=!1}timerTick(){this.timer=setTimeout(()=>{this.setState(t=>({elapsedTime:t.elapsedTime+1})),this.timerTick()},1e3)}render(){let{recording:t,i18n:i}={...this.props},{elapsedTime:r}=this.state,a=C(r);return t&&!this.timerRunning&&this.startTimer(),!t&&this.timerRunning&&this.resetTimer(),t?e("div",{style:this.wrapperStyle},e("div",{style:this.overlayStyle}),e("div",{style:this.infoContainerStyle},e("div",{style:this.infotextStyle},i("recording")),e("div",{style:this.timeStyle},a))):null}},y=p;function m(s){let{streamActive:t,i18n:i}=s;return t?e("div",{title:i("streamActive"),"aria-label":i("streamActive"),className:"uppy-ScreenCapture-icon--stream uppy-ScreenCapture-icon--streamActive"},e("svg",{"aria-hidden":"true",focusable:"false",width:"24",height:"24",viewBox:"0 0 24 24"},e("path",{d:"M0 0h24v24H0z",opacity:".1",fill:"none"}),e("path",{d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm18-7H5v1.63c3.96 1.28 7.09 4.41 8.37 8.37H19V7zM1 10v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}))):e("div",{title:i("streamPassive"),"aria-label":i("streamPassive"),className:"uppy-ScreenCapture-icon--stream"},e("svg",{"aria-hidden":"true",focusable:"false",width:"24",height:"24",viewBox:"0 0 24 24"},e("path",{d:"M0 0h24v24H0z",opacity:".1",fill:"none"}),e("path",{d:"M0 0h24v24H0z",fill:"none"}),e("path",{d:"M21 3H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11z"})))}function f(){return f=Object.assign?Object.assign.bind():function(s){for(var t=1; t<arguments.length; t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(s[r]=i[r])}return s},f.apply(null,arguments)}var g=class extends u{constructor(){super(...arguments),this.videoElement=null}componentWillUnmount(){let{onStop:t}=this.props;t()}render(){let{recording:t,stream:i,recordedVideo:r}=this.props,a={playsinline:!0};return(t||!r&&!t)&&(a.muted=!0,a.autoplay=!0,a.srcObject=i),r&&!t&&(a.muted=!1,a.controls=!0,a.src=r,this.videoElement&&(this.videoElement.srcObject=null)),e("div",{className:"uppy uppy-ScreenCapture-container"},e("div",{className:"uppy-ScreenCapture-videoContainer"},e(m,this.props),e("video",f({ref: n=>{this.videoElement=n},className:"uppy-ScreenCapture-video"},a)),e(y,this.props)),e("div",{className:"uppy-ScreenCapture-buttonContainer"},e(h,this.props),e(l,this.props)))}},b=g;var w={strings:{pluginNameScreenCapture:"Screencast",startCapturing:"Begin screen capturing",stopCapturing:"Stop screen capturing",submitRecordedFile:"Submit recorded file",streamActive:"Stream active",streamPassive:"Stream passive",micDisabled:"Microphone access denied by user",recording:"Recording"}};function v(){return v=Object.assign?Object.assign.bind():function(s){for(var t=1; t<arguments.length; t++){var i=arguments[t];for(var r in i)({}).hasOwnProperty.call(i,r)&&(s[r]=i[r])}return s},v.apply(null,arguments)}var R={version:"4.2.2"};function M(){var s;return window.MediaRecorder&&((s=navigator.mediaDevices)==null?void 0:s.getDisplayMedia)}function x(){return window.MediaRecorder&&navigator.mediaDevices}var T={displayMediaConstraints:{video:{width:1280,height:720,frameRate:{ideal:3,max:5},cursor:"motion",displaySurface:"monitor"}},userMediaConstraints:{audio:!0},preferredVideoMimeType:"video/webm"},o=class extends S{constructor(t, i){super(t,{...T,...i}),this.videoStream=null,this.audioStream=null,this.userDenied=!1,this.recorder=null,this.outputStream=null,this.recordingChunks=null,this.mediaDevices=x(),this.protocol=location.protocol==="https:"?"https":"http",this.id=this.opts.id||"ScreenCapture",this.type="acquirer",this.icon=d,this.defaultLocale=w,this.i18nInit(),this.title=this.i18n("pluginNameScreenCapture"),this.install=this.install.bind(this),this.setPluginState=this.setPluginState.bind(this),this.render=this.render.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.startRecording=this.startRecording.bind(this),this.stopRecording=this.stopRecording.bind(this),this.submit=this.submit.bind(this),this.streamInterrupted=this.streamInactivated.bind(this),this.captureActive=!1,this.capturedMediaFile=null}install(){if(!M())return this.uppy.log("Screen recorder access is not supported","warning"),null;this.setPluginState({streamActive:!1,audioStreamActive:!1});let{target:t}=this.opts;t&&this.mount(t,this)}uninstall(){this.videoStream&&this.stop(),this.unmount()}start(){return this.mediaDevices?(this.captureActive=!0,this.selectAudioStreamSource(),this.selectVideoStreamSource().then(t=>{t===!1&&this.parent&&this.parent.hideAllPanels&&(this.parent.hideAllPanels(),this.captureActive=!1)})):Promise.reject(new Error("Screen recorder access not supported"))}selectVideoStreamSource(){return this.videoStream?new Promise(t=>t(this.videoStream)):this.mediaDevices.getDisplayMedia(this.opts.displayMediaConstraints).then(t=>(this.videoStream=t,this.videoStream.addEventListener("inactive",()=>{this.streamInactivated()}),this.setPluginState({streamActive:!0}),t)).catch(t=>(this.setPluginState({screenRecError:t}),this.userDenied=!0,setTimeout(()=>{this.userDenied=!1},1e3),!1))}selectAudioStreamSource(){return this.audioStream?new Promise(t=>t(this.audioStream)):this.mediaDevices.getUserMedia(this.opts.userMediaConstraints).then(t=>(this.audioStream=t,this.setPluginState({audioStreamActive:!0}),t)).catch(t=>(t.name==="NotAllowedError"&&(this.uppy.info(this.i18n("micDisabled"),"error",5e3),this.uppy.log(this.i18n("micDisabled"),"warning")),!1))}startRecording(){let t={};this.capturedMediaFile=null,this.recordingChunks=[];let{preferredVideoMimeType:i}=this.opts;this.selectVideoStreamSource().then(r=>{if(r===!1)throw new Error("No video stream available");i&&MediaRecorder.isTypeSupported(i)&&c(i)&&(t.mimeType=i);let a=[r.getVideoTracks()[0]];this.audioStream&&a.push(this.audioStream.getAudioTracks()[0]),this.outputStream=new MediaStream(a),this.recorder=new MediaRecorder(this.outputStream,t),this.recorder.addEventListener("dataavailable", n=>{this.recordingChunks.push(n.data)}),this.recorder.start(),this.setPluginState({recording:!0})}).catch(r=>{this.uppy.log(r,"error")})}streamInactivated(){let{recordedVideo:t,recording:i}={...this.getPluginState()};!t&&!i?this.parent&&this.parent.hideAllPanels&&this.parent.hideAllPanels():i&&(this.uppy.log("Capture stream inactive \u2014 stop recording"),this.stopRecording()),this.videoStream=null,this.audioStream=null,this.setPluginState({streamActive:!1,audioStreamActive:!1})}stopRecording(){return new Promise(i=>{this.recorder.addEventListener("stop",()=>{i()}),this.recorder.stop()}).then(()=>(this.setPluginState({recording:!1}),this.getVideo())).then(i=>{this.capturedMediaFile=i,this.setPluginState({recordedVideo:URL.createObjectURL(i.data)})}).then(()=>{this.recordingChunks=null,this.recorder=null}, i=>{throw this.recordingChunks=null,this.recorder=null,i})}submit(){try{this.capturedMediaFile&&this.uppy.addFile(this.capturedMediaFile)}catch(t){t.isRestriction||this.uppy.log(t,"warning")}}stop(){this.videoStream&&(this.videoStream.getVideoTracks().forEach(t=>{t.stop()}),this.videoStream.getAudioTracks().forEach(t=>{t.stop()}),this.videoStream=null),this.audioStream&&(this.audioStream.getAudioTracks().forEach(t=>{t.stop()}),this.audioStream.getVideoTracks().forEach(t=>{t.stop()}),this.audioStream=null),this.outputStream&&(this.outputStream.getAudioTracks().forEach(t=>{t.stop()}),this.outputStream.getVideoTracks().forEach(t=>{t.stop()}),this.outputStream=null),this.setPluginState({recordedVideo:null}),this.captureActive=!1}getVideo(){let t=this.recordingChunks[0].type,i=c(t);if(!i)return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type "${t}"`));let r=`screencap-${Date.now()}.${i}`,a=new Blob(this.recordingChunks,{type:t}),n={source:this.id,name:r,data:new Blob([a],{type:t}),type:t};return Promise.resolve(n)}render(){let t=this.getPluginState();return!t.streamActive&&!this.captureActive&&!this.userDenied&&this.start(),e(b,v({},t,{onStartRecording:this.startRecording,onStopRecording:this.stopRecording,onStop:this.stop,onSubmit:this.submit,i18n:this.i18n,stream:this.videoStream}))}};o.VERSION=R.version;export{o as default};
//# sourceMappingURL=screen-capture.js.map
