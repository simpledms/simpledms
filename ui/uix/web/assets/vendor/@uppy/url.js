import{a as ut}from "../chunk-HZX4QD4C.js";import{a as I}from "../chunk-K3WB7KBA.js";import{h as y,k as st,q as at}from "../chunk-BQPEQI2I.js";import{a as J,b as Ct}from "../chunk-FW4363Y4.js";var pt=J((Zt, ct)=>{function d(e, t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}ct.exports=d;d.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};d.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};d.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var o=this;return this._timer=setTimeout(function(){o._attempts++,o._operationTimeoutCb&&(o._timeout=setTimeout(function(){o._operationTimeoutCb(o._attempts)},o._operationTimeout),o._options.unref&&o._timeout.unref()),o._fn(o._attempts)},r),this._options.unref&&this._timer.unref(),!0};d.prototype.attempt=function(e, t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};d.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)};d.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)};d.prototype.start=d.prototype.try;d.prototype.errors=function(){return this._errors};d.prototype.attempts=function(){return this._attempts};d.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,r=0,o=0; o<this._errors.length; o++){var n=this._errors[o],i=n.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=n,r=s)}return t}});var ht=J(b=>{var St=pt();b.operation=function(e){var t=b.timeouts(e);return new St(t,{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})};b.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],n=0; n<t.retries; n++)o.push(this.createTimeout(n,t));return e&&e.forever&&!o.length&&o.push(this.createTimeout(n,t)),o.sort(function(i, s){return i-s}),o};b.createTimeout=function(e, t){var r=t.randomize?Math.random()+1:1,o=Math.round(r*Math.max(t.minTimeout,1)*Math.pow(t.factor,e));return o=Math.min(o,t.maxTimeout),o};b.wrap=function(e, t, r){if(t instanceof Array&&(r=t,t=null),!r){r=[];for(var o in e)typeof e[o]=="function"&&r.push(o)}for(var n=0; n<r.length; n++){var i=r[n],s=e[i];e[i]=function(a){var f=b.operation(t),l=Array.prototype.slice.call(arguments,1),c=l.pop();l.push(function(h){f.retry(h)||(h&&(arguments[0]=f.mainError()),c.apply(this,arguments))}),f.attempt(function(){a.apply(e,l)})}.bind(e,s),e[i].options=t}}});var mt=J((ee, dt)=>{dt.exports=ht()});var K=class extends Error{constructor(){super(...arguments),this.name="UserFacingApiError"}},lt=K;var yt=Ct(mt(),1);var Ut=Object.prototype.toString,$t= e=>Ut.call(e)==="[object Error]",Ft=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function M(e){return e&&$t(e)&&e.name==="TypeError"&&typeof e.message=="string"?e.message==="Load failed"?e.stack===void 0:Ft.has(e.message):!1}var _=class extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,{message:t}=t):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}},ft=(e, t, r)=>{let o=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=o,e};async function O(e, t){return new Promise((r, o)=>{t={...t},t.onFailedAttempt??=()=>{},t.shouldRetry??=()=>!0,t.retries??=10;let n=yt.default.operation(t),i=()=>{n.stop(),o(t.signal?.reason)};t.signal&&!t.signal.aborted&&t.signal.addEventListener("abort",i,{once:!0});let s=()=>{t.signal?.removeEventListener("abort",i),n.stop()};n.attempt(async u=>{try{let a=await e(u);s(),r(a)}catch(a){try{if(!(a instanceof Error))throw new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`);if(a instanceof _)throw a.originalError;if(a instanceof TypeError&&!M(a))throw a;if(ft(a,u,t),await t.shouldRetry(a)||(n.stop(),o(a)),await t.onFailedAttempt(a),!n.retry(a))throw n.mainError()}catch(f){ft(f,u,t),s(),o(f)}}})})}function W(){return fetch(...arguments).catch(e=>{throw e.name==="AbortError"?e:new ut(e)})}function j(e, t){return Object.prototype.hasOwnProperty.call(e,t)}var z=class extends Error{constructor(t, r){super(t),this.cause=r?.cause,this.cause&&j(this.cause,"isNetworkError")?this.isNetworkError=this.cause.isNetworkError:this.isNetworkError=!1}},gt=z;function V(e){var t;let o=(t=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?([^\n]+)/i.exec(e))==null?void 0:t[1];return`${/^http:\/\//i.test(e)?"ws":"wss"}://${o}`}var B=class extends Error{constructor(){super("Authorization required"),this.name="AuthError",this.isAuthError=!0}},wt=B;function g(e, t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var It=0;function L(e){return"__private_"+It+++"_"+e}var Ot={version:"4.4.1"};function Lt(e){return e.replace(/\/$/,"")}var vt=10,qt=5*60*1e3,kt=401,G=class extends Error{constructor(t){let{statusCode:r,message:o}=t;super(o),this.name="HttpError",this.statusCode=r}};async function Nt(e){if(e.status===kt)throw new wt;if(e.ok)return e.json();let t=`Failed request with status: ${e.status}. ${e.statusText}`,r;try{r=await e.json(),r.message&&(t=`${t} message: ${r.message}`),r.requestId&&(t=`${t} request-Id: ${r.requestId}`)}catch(o){throw new Error(t,{cause:o})}throw e.status>=400&&e.status<=499&&r.message?new lt(r.message):new G({statusCode:e.status,message:t})}function Dt(e, t, r){let{progress:o,bytesUploaded:n,bytesTotal:i}=t;if(o){var s;e.uppy.log(`Upload progress: ${o}`),e.uppy.emit("upload-progress",r,{uploadStarted:(s=r.progress.uploadStarted)!=null?s:0,bytesUploaded:n,bytesTotal:i})}}var w=L("companionHeaders"),x=L("getUrl"),Q=L("requestSocketToken"),P=L("awaitRemoteFileUpload"),v=class{constructor(t, r){Object.defineProperty(this,P,{value:Jt}),Object.defineProperty(this,x,{value:Ht}),Object.defineProperty(this,w,{writable:!0,value:void 0}),Object.defineProperty(this,Q,{writable:!0,value:async o=>{var n;let{file:i,postBody:s,signal:u}=o;if(((n=i.remote)==null?void 0:n.url)==null)throw new Error("Cannot connect to an undefined URL");return(await this.post(i.remote.url,{...i.remote.body,...s},{signal:u})).token}}),this.uppy=t,this.opts=r,this.onReceiveResponse=this.onReceiveResponse.bind(this),g(this,w)[w]=r.companionHeaders}setCompanionHeaders(t){g(this,w)[w]=t}[Symbol.for("uppy test: getCompanionHeaders")](){return g(this,w)[w]}get hostname(){let{companion:t}=this.uppy.getState(),r=this.opts.companionUrl;return Lt(t&&t[r]?t[r]:r)}async headers(t){return t===void 0&&(t=!1),{...{Accept:"application/json",...t?void 0:{"Content-Type":"application/json"}},...g(this,w)[w]}}onReceiveResponse(t){let{headers:r}=t,n=this.uppy.getState().companion||{},i=this.opts.companionUrl;r.has("i-am")&&r.get("i-am")!==n[i]&&this.uppy.setState({companion:{...n,[i]:r.get("i-am")}})}async request(t){let{path:r,method:o="GET",data:n,skipPostResponse:i,signal:s}=t;try{let u=await this.headers(!n),a=await W(g(this,x)[x](r),{method:o,signal:s,headers:u,credentials:this.opts.companionCookiesRule||"same-origin",body:n?JSON.stringify(n):null});return i||this.onReceiveResponse(a),await Nt(a)}catch(u){throw u.isAuthError||u.name==="UserFacingApiError"||u.name==="AbortError"?u:new gt(`Could not ${o} ${g(this,x)[x](r)}`,{cause:u})}}async get(t, r){return this.request({...r,path:t})}async post(t, r, o){return this.request({...o,path:t,method:"POST",data:r})}async delete(t, r, o){return this.request({...o,path:t,method:"DELETE",data:r})}async uploadRemoteFile(t, r, o){var n=this;try{let{signal:i,getQueue:s}=o||{};return await O(async()=>{var u;let a=(u=this.uppy.getFile(t.id))==null?void 0:u.serverToken;if(a!=null)return this.uppy.log(`Connecting to exiting websocket ${a}`),g(this,P)[P]({file:t,queue:s(),signal:i});let l=await s().wrapPromiseFunction(async function(){try{return await g(n,Q)[Q](...arguments)}catch(c){if(c.isAuthError)throw new _(c);if(c.cause==null)throw c;let h=c.cause,R=()=>[408,409,429,418,423].includes(h.statusCode)||h.statusCode>=500&&h.statusCode<=599&&![501,505].includes(h.statusCode);throw h.name==="HttpError"&&!R()?new _(h):h}},{priority:-1})({file:t,postBody:r,signal:i}).abortOn(i);if(this.uppy.getFile(t.id))return this.uppy.setFileState(t.id,{serverToken:l}),g(this,P)[P]({file:this.uppy.getFile(t.id),queue:s(),signal:i})},{retries:vt,signal:i,onFailedAttempt: u=>this.uppy.log(`Retrying upload due to: ${u.message}`,"warning")})}catch(i){if(i.name==="AbortError")return;throw this.uppy.emit("upload-error",t,i),i}}};function Ht(e){return/^(https?:|)\/\//.test(e)?e:`${this.hostname}/${e}`}async function Jt(e){let{file:t,queue:r,signal:o}=e,n,{capabilities:i}=this.uppy.getState();try{return await new Promise((s, u)=>{let a=t.serverToken,f=V(t.remote.companionUrl),l,c,h,{isPaused:R}=t,S=(p, m)=>{if(l==null||l.readyState!==l.OPEN){var T;this.uppy.log(`Cannot send "${p}" to socket ${t.id} because the socket state was ${String((T=l)==null?void 0:T.readyState)}`,"warning");return}l.send(JSON.stringify({action:p,payload:m??{}}))};function X(){i.resumableUploads&&S(R?"pause":"resume")}let At=async()=>{c&&c.abort(),c=new AbortController;let p= T=>{var U;this.uppy.setFileState(t.id,{serverToken:null}),(U=c)==null||U.abort==null||U.abort(),u(T)};function m(){clearTimeout(h),!R&&(h=setTimeout(()=>p(new Error("Timeout waiting for message from Companion socket")),qt))}try{await r.wrapPromiseFunction(async()=>{await O(async()=>new Promise((U, xt)=>{l=new WebSocket(`${f}/api/${a}`),m(),l.addEventListener("close",()=>{l=void 0,xt(new Error("Socket closed unexpectedly"))}),l.addEventListener("error", D=>{var A;this.uppy.log(`Companion socket error ${JSON.stringify(D)}, closing socket`,"warning"),(A=l)==null||A.close()}),l.addEventListener("open",()=>{X()}),l.addEventListener("message", D=>{m();try{let{action:$,payload:E}=JSON.parse(D.data);switch($){case"progress":{Dt(this,E,this.uppy.getFile(t.id));break}case"success":{var A,it,nt,H;let F=(A=E.response)==null?void 0:A.responseText;this.uppy.emit("upload-success",this.uppy.getFile(t.id),{uploadURL:E.url,status:(it=(nt=E.response)==null?void 0:nt.status)!=null?it:200,body:F?JSON.parse(F):void 0}),(H=c)==null||H.abort==null||H.abort(),s();break}case"error":{let{message:F}=E.error;throw Object.assign(new Error(F),{cause:E.error})}default:this.uppy.log(`Companion socket unknown action ${$}`,"warning")}}catch($){p($)}});let Pt=()=>{this.uppy.log(`Closing socket ${t.id}`),clearTimeout(h),l&&l.close(),l=void 0};c.signal.addEventListener("abort",()=>{Pt()})}),{retries:vt,signal:c.signal,onFailedAttempt:()=>{c.signal.aborted||this.uppy.log(`Retrying websocket ${t.id}`)}})})().abortOn(c.signal)}catch(T){if(c.signal.aborted)return;p(T)}},N= p=>{i.resumableUploads&&(R=p,l&&X())},Z= p=>{var m;i.individualCancellation&&p.id===t.id&&(S("cancel"),(m=c)==null||m.abort==null||m.abort(),this.uppy.log(`upload ${t.id} was removed`),s())},tt=()=>{var p;S("cancel"),(p=c)==null||p.abort==null||p.abort(),this.uppy.log(`upload ${t.id} was canceled`),s()},et=(p, m)=>{p?.id===t.id&&N(m)},rt=()=>N(!0),ot=()=>N(!1);this.uppy.on("file-removed",Z),this.uppy.on("cancel-all",tt),this.uppy.on("upload-pause",et),this.uppy.on("pause-all",rt),this.uppy.on("resume-all",ot),n=()=>{this.uppy.off("file-removed",Z),this.uppy.off("cancel-all",tt),this.uppy.off("upload-pause",et),this.uppy.off("pause-all",rt),this.uppy.off("resume-all",ot)},o.addEventListener("abort",()=>{var p;(p=c)==null||p.abort()}),At()})}finally{n?.()}}v.VERSION=Ot.version;var Mt="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";var Tt=(e=21)=>{let t="",r=e|0;for(; r--;)t+=Mt[Math.random()*64|0];return t};function bt(e, t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var Wt=0;function jt(e){return"__private_"+Wt+++"_"+e}var C=jt("handleSubmit"),Y=class extends st{constructor(t){super(t),this.form=document.createElement("form"),Object.defineProperty(this,C,{writable:!0,value: r=>{r.preventDefault();let{addFile:o}=this.props,n=this.input.value.trim();o(n)}}),this.form.id=Tt()}componentDidMount(){this.input.value="",this.form.addEventListener("submit",bt(this,C)[C]),document.body.appendChild(this.form)}componentWillUnmount(){this.form.removeEventListener("submit",bt(this,C)[C]),document.body.removeChild(this.form)}render(){let{i18n:t}=this.props;return y("div",{className:"uppy-Url"},y("input",{className:"uppy-u-reset uppy-c-textInput uppy-Url-input",type:"text","aria-label":t("enterUrlToImport"),placeholder:t("enterUrlToImport"),ref: r=>{this.input=r},"data-uppy-super-focusable":!0,form:this.form.id}),y("button",{className:"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Url-importButton",type:"submit",form:this.form.id},t("import")))}},Et=Y;function q(e, t, r){let o=I(e.items),n;switch(t){case"paste":{if(o.some(s=>s.kind==="file"))return;n=o.filter(s=>s.kind==="string"&&s.type==="text/plain");break}case"drop":{n=o.filter(i=>i.kind==="string"&&i.type==="text/uri-list");break}default:throw new Error(`isDropOrPaste must be either 'drop' or 'paste', but it's ${t}`)}n.forEach(i=>{i.getAsString(s=>r(s))})}var _t={strings:{pluginNameUrl:"Link",import:"Import",enterUrlToImport:"Enter URL to import a file",failedToFetch:"Companion failed to fetch this URL, please make sure it\u2019s correct",enterCorrectUrl:"Incorrect URL: Please make sure you are entering a direct link to a file"}};var Rt,zt={version:"4.2.3"};function Vt(){return y("svg",{"aria-hidden":"true",focusable:"false",width:"32",height:"32",viewBox:"0 0 32 32"},y("path",{d:"M23.637 15.312l-2.474 2.464a3.582 3.582 0 01-.577.491c-.907.657-1.897.986-2.968.986a4.925 4.925 0 01-3.959-1.971c-.248-.329-.164-.902.165-1.149.33-.247.907-.164 1.155.164 1.072 1.478 3.133 1.724 4.618.656a.642.642 0 00.33-.328l2.473-2.463c1.238-1.313 1.238-3.366-.082-4.597a3.348 3.348 0 00-4.618 0l-1.402 1.395a.799.799 0 01-1.154 0 .79.79 0 010-1.15l1.402-1.394a4.843 4.843 0 016.843 0c2.062 1.805 2.144 5.007.248 6.896zm-8.081 5.664l-1.402 1.395a3.348 3.348 0 01-4.618 0c-1.319-1.23-1.319-3.365-.082-4.596l2.475-2.464.328-.328c.743-.492 1.567-.739 2.475-.657.906.165 1.648.574 2.143 1.314.248.329.825.411 1.155.165.33-.248.412-.822.165-1.15-.825-1.068-1.98-1.724-3.216-1.888-1.238-.247-2.556.082-3.628.902l-.495.493-2.474 2.464c-1.897 1.969-1.814 5.09.083 6.977.99.904 2.226 1.396 3.463 1.396s2.473-.492 3.463-1.395l1.402-1.396a.79.79 0 000-1.15c-.33-.328-.908-.41-1.237-.082z",fill:"#FF753E","fill-rule":"nonzero"}))}function Bt(e){let t=/^[a-z0-9]+:\/\//,r="http://";return t.test(e)?e:r+e}function Qt(e){return I(e.dataTransfer.items).filter(o=>o.kind==="string"&&o.type==="text/uri-list").length>0}function Gt(e){return e?.startsWith("http://")||e?.startsWith("https://")}function Yt(e){let{pathname:t}=new URL(e);return t.substring(t.lastIndexOf("/")+1)}var k=class e extends at{constructor(t, r){if(super(t,r),this.getMeta= o=>this.client.post("url/meta",{url:o}),this.addFile=async(o, n)=>{if(o.startsWith("blob"))return;let i=Bt(o);if(!Gt(i)){this.uppy.log(`[URL] Incorrect URL entered: ${i}`),this.uppy.info(this.i18n("enterCorrectUrl"),"error",4e3);return}this.uppy.log(`[URL] Adding file from dropped/pasted url: ${i}`);try{let s=await this.getMeta(i),u={meta:n,source:this.id,name:s.name||Yt(i),type:s.type,data:{size:s.size},isRemote:!0,body:{url:i},remote:{companionUrl:this.opts.companionUrl,url:`${this.hostname}/url/get`,body:{fileId:i,url:i},requestClientId:e.requestClientId}};this.uppy.log("[Url] Adding remote file");try{return this.uppy.addFile(u)}catch(a){return a.isRestriction||this.uppy.log(a),a}}catch(s){return this.uppy.log(s),this.uppy.info({message:this.i18n("failedToFetch"),details:s},"error",4e3),s}},this.handleRootDrop= o=>{q(o.dataTransfer,"drop", n=>{this.addFile(n)})},this.handleRootPaste= o=>{q(o.clipboardData,"paste", n=>{this.addFile(n)})},this.id=this.opts.id||"Url",this.type="acquirer",this.icon=()=>y(Vt,null),this.defaultLocale=_t,this.i18nInit(),this.title=this.i18n("pluginNameUrl"),this.hostname=this.opts.companionUrl,!this.hostname)throw new Error("Companion hostname is required, please consult https://uppy.io/docs/companion");this.client=new v(t,{pluginId:this.id,provider:"url",companionUrl:this.opts.companionUrl,companionHeaders:this.opts.companionHeaders,companionCookiesRule:this.opts.companionCookiesRule}),this.uppy.registerRequestClient(e.requestClientId,this.client)}render(){return y(Et,{i18n:this.i18n,addFile:this.addFile})}install(){let{target:t}=this.opts;t&&this.mount(t,this)}uninstall(){this.unmount()}};Rt=k;k.VERSION=zt.version;k.requestClientId=Rt.name;k.prototype.canHandleRootDrop=Qt;export{k as default};
//# sourceMappingURL=url.js.map
